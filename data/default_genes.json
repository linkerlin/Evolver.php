[
  {
    "type": "Gene",
    "id": "gene_gep_repair_from_errors",
    "category": "repair",
    "signals_match": ["error", "exception", "failed", "unstable", "log_error", "recurring_error"],
    "preconditions": ["signals contains error-related indicators"],
    "strategy": [
      "Extract structured signals from logs and user instructions",
      "Select an existing Gene by signals match (no improvisation)",
      "Estimate blast radius (files, lines) before editing",
      "Apply smallest reversible patch",
      "Validate using declared validation steps; rollback on failure",
      "Solidify knowledge: append EvolutionEvent, update Gene/Capsule store"
    ],
    "constraints": {
      "max_files": 20,
      "forbidden_paths": [".git", "vendor", "node_modules"]
    },
    "validation": ["php -l src/*.php", "php evolver.php --validate"],
    "epigenetic_marks": []
  },
  {
    "type": "Gene",
    "id": "gene_gep_optimize_prompt_and_assets",
    "category": "optimize",
    "signals_match": ["protocol", "gep", "prompt", "audit", "reusable", "optimize"],
    "preconditions": ["need stricter, auditable evolution protocol outputs"],
    "strategy": [
      "Extract signals and determine selection rationale via Selector JSON",
      "Prefer reusing existing Gene/Capsule; only create if no match exists",
      "Refactor prompt assembly to embed assets (genes, capsules, parent event)",
      "Reduce noise and ambiguity; enforce strict output schema",
      "Validate by running php evolver.php and ensuring no runtime errors",
      "Solidify: record EvolutionEvent, update Gene definitions, create Capsule on success"
    ],
    "constraints": {
      "max_files": 20,
      "forbidden_paths": [".git", "vendor", "node_modules"]
    },
    "validation": ["php -l src/*.php"],
    "epigenetic_marks": []
  },
  {
    "type": "Gene",
    "id": "gene_gep_innovate_from_opportunity",
    "category": "innovate",
    "signals_match": [
      "user_feature_request",
      "user_improvement_suggestion",
      "perf_bottleneck",
      "capability_gap",
      "stable_success_plateau",
      "external_opportunity"
    ],
    "preconditions": [
      "at least one opportunity signal is present",
      "no active log_error signals (stability first)"
    ],
    "strategy": [
      "Extract opportunity signals and identify the specific user need or system gap",
      "Search existing Genes and Capsules for partial matches (avoid reinventing)",
      "Design a minimal, testable implementation plan (prefer small increments)",
      "Estimate blast radius; innovate changes may touch more files but must stay within constraints",
      "Implement the change with clear validation criteria",
      "Validate using declared validation steps; rollback on failure",
      "Solidify: record EvolutionEvent with intent=innovate, create new Gene if pattern is novel, create Capsule on success"
    ],
    "constraints": {
      "max_files": 25,
      "forbidden_paths": [".git", "vendor", "node_modules"]
    },
    "validation": ["php -l src/*.php"],
    "epigenetic_marks": []
  },
  {
    "type": "Gene",
    "id": "gene_gep_repair_sqlite",
    "category": "repair",
    "signals_match": ["sqlite", "database", "db_error", "pdo", "sql"],
    "preconditions": ["database error or connection issue detected"],
    "strategy": [
      "Check SQLite file permissions and path",
      "Verify WAL mode and mmap_size settings",
      "Test database connectivity with minimal query",
      "Repair schema if tables are missing",
      "Validate all CRUD operations work correctly"
    ],
    "constraints": {
      "max_files": 5,
      "forbidden_paths": [".git", "vendor"]
    },
    "validation": ["php -r \"new SQLite3(':memory:'); echo 'ok';\""],
    "epigenetic_marks": []
  },
  {
    "type": "Gene",
    "id": "gene_gep_harden_security",
    "category": "optimize",
    "signals_match": ["security", "injection", "xss", "validation", "sanitize", "harden"],
    "preconditions": ["security concern or hardening request detected"],
    "strategy": [
      "Identify all user-controlled inputs",
      "Apply strict input validation and sanitization",
      "Use parameterized queries for all SQL",
      "Enforce command whitelist for any shell execution",
      "Add logging for security-relevant events",
      "Validate with static analysis"
    ],
    "constraints": {
      "max_files": 15,
      "forbidden_paths": [".git", "vendor"]
    },
    "validation": ["php -l src/*.php"],
    "epigenetic_marks": []
  }
]
